name: Lint and LOC guard

on:
  push:
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install linters
        run: |
          python -m pip install --upgrade pip
          pip install ruff
      - name: Run ruff
        run: ruff check .
      - name: LOC guard (< 400 LOC per file)
        run: |
          violate=$(awk 'BEGIN{f=0} /^\*\*\* Begin Patch/{f=1} END{print 0}' /dev/null) # noop
          too_long=$(find steer_llm_sdk -name "*.py" -type f -print0 | xargs -0 awk 'BEGIN{n=0;f=""} {n++} ENDFILE{if(n>400){print FILENAME;}; n=0}')
          if [ -n "$too_long" ]; then
            echo "Files exceeding 400 LOC:"; echo "$too_long"; exit 1; fi

